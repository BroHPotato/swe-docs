\section{Architettura} 
	\subsection{Descrizione generale}
		L'architettura generale scelta per il prodotto è l'\textit{event-driven microservice}. 
		L'architettura è formata da più componenti che dialogano con un broker di Kafka, mentre effettuano la persistenza dei dati in un database di tipo timeseries. Il tutto è gestito da una web-app e da delle api REST, grazie alle quali vengono propagati i comandi dell'applicazione web.
		Più precisamente il/i \textit{gateway} comunica/comunicano tramite un/dei topic di Kafka; i dati vengono poi estratti dal \textit{data collector} che li inserisce nel database Timescale, mentre effettua anche un controllo dei dati inserendo i messaggi di alert in un apposito topic di Kafka. La componente \textit{api} invece riceve da Kafka gli alert e notifica gli utenti tramite un \textit{bot Telegram} previa registrazione nella \textit{web-app}. Proprio in quest'ultima vengono visualizzati i dati reperiti tramite le \textit{api} ed eventualmente modificate le impostazioni di utenti, enti o gateway.

		Questo tipo di architettura è stato scelto perchè:
		\begin{itemize}
		 	\item \textbf{Richiesto dal capitolato}: il capitolato C6 richiede un'architettura in cui uno o più gateway inviano dati in uno o più topic di Kafka dal quale vengono presi ed inseriti in un database. Questi dati devono poi essere mostrati in una web-app tramite l'uso di api;
		 	\item \textbf{Alta scalabilità}: questo tipo di architettura permette di duplicare alcuni nodi nel caso in cui questi dovessero risultare dei colli di bottiglia, permettendo quindi evitare i problemi di scalabilità che si potrebbero avere utilizzando un tipo di architettura layered per la totalità del prodotto;
		 	\item \textbf{Semplicità}: poiché ThiReMa è composto da varie componenti con compiti piuttosto limitati, lo sviluppo delle varie parti separate tra loro semplifica di molto la complessità nello sviluppo del progetto;
		 	\item \textbf{Facilità nel rilascio}: infine essendo una architettura composta da parti interdipendenti è possibile effettuare il deploy delle varie componenti in host differenti, senza contare che nel caso fosse necessaria la manutenzione di una singola componente non è necessario fermare l'intera architettura.
		\end{itemize}

		Le principali componenti del sistema sono:
		\begin{itemize}
		  	\item \textbf{gateway};
		  	\item \textbf{broker Kafka}: attraverso questa componente è possibile ricevere i dati dai vari gateway dislocati nelle varie aziende ma permette anche di inviare delle configurazioni per ogni singolo gateway a partire dalla web-app. Questa componente viene configurata tramite un Dockerfile nel momento della sua creazione;
		  	\item \textbf{data collector};
		  	\item \textbf{api REST};
		  	\item \textbf{bot Telegram};
		  	\item \textbf{database}: i due database presenti all'interno del sistema permettono uno la persistenza dei dati ricevuti dai gateway (Timescale) e l'altro il salvataggio delle informazioni utilizzate dalla web-app quali ad esempio le credenziali degli utenti, le configurazioni dei gateway o le impostazioni de grafici.
		  	\item \textbf{web-app}.    
		\end{itemize} 



			









